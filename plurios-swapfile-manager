#!/bin/bash
# Author: @FershoUno
# Translation code made by crims0n from the MiniOS installer project


check_root(){
    if [[ $EUID -ne 0 ]]; then
        pkexec "$0"
        exit 0
    fi
}

translate() {
    local TEXT=$1
    if [ ! -f /etc/plurios-release ]; then
        local LNG=$(locale | grep LANG | cut -d= -f2 | cut -d_ -f1)
    else
        if grep -q Pro /etc/plurios-release ; then
        LNG=es
        elif grep -q Aymara /etc/plurios-release ; then
        LNG=ay
        fi
    fi
#    local TRANSLATION_FILE="/usr/share/plurios/plurios-swapfile-manager/translate/$LNG.json"
    local TRANSLATION_FILE="translate/$LNG.json"
    if [ -f "$TRANSLATION_FILE" ]; then
        local TRANSLATION=$(jq -r --arg TEXT "$TEXT" '.[$TEXT]' "$TRANSLATION_FILE")
        if [ "$TRANSLATION" != "null" ]; then
            echo $TRANSLATION
        else
            echo $TEXT
        fi
    else
        echo $TEXT
    fi
}

detect_the_swap_type() {
    SWAP_TYPE=0
    while read -r name _; do
        if [[ "$name" == /dev/zram* ]]; then
            echo "ZRAM swap detectado: $name"
            SWAP_TYPE="ZRAM"
        elif [[ -f "$name" ]]; then
            echo "Swapfile detectado: $name"
            SWAP_TYPE="SWAPFILE"
        elif [[ "$name" == /dev/* ]]; then
            echo "Partici√≥n swap detectada: $name"
            SWAP_TYPE="PARTITION"
        fi
    done < <(swapon --noheadings --show=NAME)

    if [[ $SWAP_TYPE -eq 0 ]]; then
        echo "No hay swap activa"
    fi
}

check_swapfile(){
yad --window-icon "plurios-icon" \
        --image "dialog-question" \
	--title "$(translate 'Alert')" \
	--text "$(translate 'No Swapfile found, do you want to create one?')" \
	--button="$(translate 'Add')!gtk-add":0 \
	--button="$(translate 'Cancel')!gtk-cancel":1 \
	option=$?

[[ $option -eq 0 ]] && echo "$(translate 'Creating SWAPFILE')"
[[ $option -eq 1 ]] && echo "$(translate 'Exit')"
}

check_root
check_swapfile
